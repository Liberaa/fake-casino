<%- include('partials/header') %>
<%- include('partials/navbar', { user }) %>

<style>
.shop-container {
  max-width: 1200px;
  margin: 2rem auto;
  padding: 2rem;
}

.shop-header {
  text-align: center;
  margin-bottom: 3rem;
}

.shop-header h1 {
  font-size: 2.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 1rem;
}

.shop-subtitle {
  color: #888;
  font-size: 1.1rem;
}

.packages-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 2rem;
  margin-bottom: 3rem;
}

.package-card {
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
  border: 2px solid rgba(102, 126, 234, 0.3);
  border-radius: 20px;
  padding: 2rem;
  text-align: center;
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.package-card:hover {
  transform: translateY(-10px);
  border-color: #667eea;
  box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
}

.package-card.popular {
  border-color: #fbbf24;
  background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
}

.package-card.popular::before {
  content: 'â­ POPULAR';
  position: absolute;
  top: 1rem;
  right: -2rem;
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  color: #000;
  padding: 0.5rem 3rem;
  transform: rotate(45deg);
  font-weight: bold;
  font-size: 0.8rem;
}

.package-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.package-name {
  font-size: 1.5rem;
  font-weight: bold;
  color: #fff;
  margin-bottom: 0.5rem;
}

.package-coins {
  font-size: 2.5rem;
  font-weight: bold;
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 1rem;
}

.package-price {
  font-size: 1.8rem;
  color: #10b981;
  font-weight: bold;
  margin-bottom: 1.5rem;
}

.package-bonus {
  background: rgba(16, 185, 129, 0.2);
  border: 1px solid #10b981;
  border-radius: 10px;
  padding: 0.5rem;
  color: #10b981;
  font-size: 0.9rem;
  margin-bottom: 1.5rem;
}

.buy-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  padding: 1rem 2rem;
  border-radius: 10px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  width: 100%;
  transition: all 0.3s ease;
}

.buy-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.5);
}

.buy-btn:active {
  transform: scale(0.98);
}

.package-card.popular .buy-btn {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  color: #000;
}

.secure-badge {
  text-align: center;
  margin: 2rem 0;
  color: #888;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.features-list {
  background: rgba(0, 0, 0, 0.2);
  border-radius: 15px;
  padding: 2rem;
  margin-top: 3rem;
}

.features-list h3 {
  color: #fff;
  font-size: 1.5rem;
  margin-bottom: 1.5rem;
  text-align: center;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
}

.feature-icon {
  font-size: 2rem;
}

.feature-text {
  color: #fff;
}

.current-balance {
  text-align: center;
  background: rgba(102, 126, 234, 0.1);
  border: 2px solid rgba(102, 126, 234, 0.3);
  border-radius: 15px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.balance-label {
  color: #888;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.balance-amount {
  font-size: 2rem;
  font-weight: bold;
  color: #fbbf24;
}
</style>

<div class="shop-container">
  <div class="shop-header">
    <h1>ğŸ›’ Brap Coin Shop</h1>
    <p class="shop-subtitle">Purchase Brap Coins to play our casino games!</p>
  </div>

  <div class="current-balance">
    <div class="balance-label">Your Current Balance</div>
    <div class="balance-amount">ğŸ’° <%= user.credits.toFixed(2) %> Brap Coins</div>
  </div>

  <div class="packages-grid">
    <!-- Mini Package -->
    <div class="package-card">
      <div class="package-icon">ğŸª™</div>
      <div class="package-name">Mini Pack</div>
      <div class="package-coins">1,000</div>
      <div class="package-coins" style="font-size: 1rem; color: #888;">Brap Coins</div>
      <div class="package-price">$0.99</div>
      <button class="buy-btn" onclick="buyPackage('mini', 1000, 0.99)">
        Buy Now
      </button>
    </div>

    <!-- Starter Package -->
    <div class="package-card">
      <div class="package-icon">ğŸ²</div>
      <div class="package-name">Starter Pack</div>
      <div class="package-coins">2,500</div>
      <div class="package-coins" style="font-size: 1rem; color: #888;">Brap Coins</div>
      <div class="package-price">$1.99</div>
      <button class="buy-btn" onclick="buyPackage('starter', 2500, 1.99)">
        Buy Now
      </button>
    </div>

    <!-- Popular Package -->
    <div class="package-card popular">
      <div class="package-icon">ğŸ’</div>
      <div class="package-name">Popular Pack</div>
      <div class="package-coins">5,000</div>
      <div class="package-coins" style="font-size: 1rem; color: #888;">Brap Coins</div>
      <div class="package-bonus">+500 BONUS COINS!</div>
      <div class="package-price">$4.99</div>
      <button class="buy-btn" onclick="buyPackage('popular', 5500, 4.99)">
        Buy Now
      </button>
    </div>

    <!-- Premium Package -->
    <div class="package-card">
      <div class="package-icon">ğŸ†</div>
      <div class="package-name">Premium Pack</div>
      <div class="package-coins">15,000</div>
      <div class="package-coins" style="font-size: 1rem; color: #888;">Brap Coins</div>
      <div class="package-bonus">+2,000 BONUS COINS!</div>
      <div class="package-price">$9.99</div>
      <button class="buy-btn" onclick="buyPackage('premium', 17000, 9.99)">
        Buy Now
      </button>
    </div>

    <!-- Mega Package -->
    <div class="package-card">
      <div class="package-icon">ğŸš€</div>
      <div class="package-name">Mega Pack</div>
      <div class="package-coins">50,000</div>
      <div class="package-coins" style="font-size: 1rem; color: #888;">Brap Coins</div>
      <div class="package-bonus">+10,000 BONUS COINS!</div>
      <div class="package-price">$19.99</div>
      <button class="buy-btn" onclick="buyPackage('mega', 60000, 19.99)">
        Buy Now
      </button>
    </div>

    <!-- Ultimate Package -->
    <div class="package-card">
      <div class="package-icon">ğŸ‘‘</div>
      <div class="package-name">Ultimate Pack</div>
      <div class="package-coins">100,000</div>
      <div class="package-coins" style="font-size: 1rem; color: #888;">Brap Coins</div>
      <div class="package-bonus">+25,000 BONUS COINS!</div>
      <div class="package-price">$49.99</div>
      <button class="buy-btn" onclick="buyPackage('ultimate', 125000, 49.99)">
        Buy Now
      </button>
    </div>
  </div>

  <div class="secure-badge">
    ğŸ”’ Secure payment powered by Stripe â€¢ Card & Klarna accepted
  </div>

  <div class="features-list">
    <h3>âœ¨ Why Buy Brap Coins?</h3>
    <div class="features-grid">
      <div class="feature-item">
        <div class="feature-icon">âš¡</div>
        <div class="feature-text">Instant delivery to your account</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">ğŸ°</div>
        <div class="feature-text">Play all casino games</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">ğŸ†</div>
        <div class="feature-text">Compete on leaderboards</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">ğŸ</div>
        <div class="feature-text">Bonus coins on larger packs</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">ğŸ”</div>
        <div class="feature-text">Secure Stripe checkout</div>
      </div>
      <div class="feature-item">
        <div class="feature-icon">ğŸ“ˆ</div>
        <div class="feature-text">Level up faster with more coins</div>
      </div>
    </div>
  </div>

  <a href="/lobby" class="btn-back" style="display: inline-block; margin-top: 2rem; padding: 1rem 2rem; background: rgba(255, 255, 255, 0.1); border-radius: 10px; color: #fff; text-decoration: none;">
    â† Back to Lobby
  </a>
</div>

<script>
async function buyPackage(packageName, coins, price) {
  try {
    // Show loading
    const btn = event.target
    btn.disabled = true
    btn.textContent = 'Loading...'

    // Create Stripe checkout session
    const res = await fetch('/shop/checkout', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ packageName })
    })
    
    const data = await res.json()
    
    if (data.success && data.url) {
      // Redirect to Stripe checkout
      window.location.href = data.url
    } else {
      btn.disabled = false
      btn.textContent = 'Try Again'
      btn.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'
      setTimeout(() => {
        btn.textContent = 'Buy Now'
        btn.style.background = ''
      }, 2000)
    }
  } catch (error) {
    console.error('Purchase error:', error)
    event.target.disabled = false
    event.target.textContent = 'Try Again'
    event.target.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'
    setTimeout(() => {
      event.target.textContent = 'Buy Now'
      event.target.style.background = ''
    }, 2000)
  }
}
</script>

<%- include('partials/footer') %>
