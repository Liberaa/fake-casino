<nav class="navbar">
  <div class="nav-container">
    <div class="nav-brand">ðŸŽ° Brap Casino</div>
    <% if (typeof user !== 'undefined') { %>
      <div class="nav-links">
        <a href="/shop">Shop</a>
        <a href="/lobby">Lobby</a>
        <a href="/chat">Chat</a>
        <a href="/leaderboard">Leaderboard</a>
        <div class="nav-credits">ðŸ’° <%= user.credits.toFixed(2) %> Brap Coins</div>
        
        <!-- Level Display in Navbar -->
        <div class="nav-level">
          <% 
            let badge = 'ðŸŽ®';
            if (user.level >= 1000) badge = 'ðŸ‘‘';
            else if (user.level >= 500) badge = 'ðŸ’Ž';
            else if (user.level >= 100) badge = 'ðŸ¥‡';
          %>
          <span class="level-badge"><%= badge %></span>
          <span class="level-text">Lvl <strong id="navLevel"><%= user.level %></strong></span>
          <div class="level-mini-bar">
            <div class="level-mini-progress" id="navLevelProgress" style="width: 0%"></div>
          </div>
        </div>
        
        <button onclick="logout()" class="btn-logout">Logout</button>
      </div>
    <% } %>
  </div>
</nav>

<style>
.navbar {
  background: linear-gradient(135deg, #1e1e2e 0%, #2a2a3e 100%);
  padding: 1rem 2rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  position: sticky;
  top: 0;
  z-index: 100;
}

.nav-container {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.nav-brand {
  font-size: 1.5rem;
  font-weight: bold;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.nav-links {
  display: flex;
  align-items: center;
  gap: 1.5rem;
}

.nav-links a {
  color: #fff;
  text-decoration: none;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.nav-links a:hover {
  background: rgba(102, 126, 234, 0.2);
}

.nav-credits {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 0.5rem 1.5rem;
  border-radius: 20px;
  font-weight: bold;
  color: #fff;
}

.nav-level {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  background: rgba(0, 0, 0, 0.3);
  padding: 0.5rem 1rem;
  border-radius: 20px;
  border: 2px solid rgba(102, 126, 234, 0.3);
  min-width: 120px;
}

.level-badge {
  font-size: 1.2rem;
}

.level-text {
  color: #fff;
  font-size: 0.9rem;
}

.level-text strong {
  color: #fbbf24;
}

.level-mini-bar {
  flex: 1;
  height: 4px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 2px;
  overflow: hidden;
  min-width: 40px;
}

.level-mini-progress {
  height: 100%;
  background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
  transition: width 0.5s ease;
  border-radius: 2px;
}

.btn-logout {
  background: rgba(239, 68, 68, 0.2);
  color: #ef4444;
  border: 2px solid #ef4444;
  padding: 0.5rem 1.5rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.3s ease;
}

.btn-logout:hover {
  background: #ef4444;
  color: #fff;
}

/* Level up notification */
.level-up-notification {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(0);
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 3rem 4rem;
  border-radius: 20px;
  text-align: center;
  z-index: 2000;
  opacity: 0;
  pointer-events: none;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.level-up-notification.show {
  animation: levelUpShow 2s ease;
}

@keyframes levelUpShow {
  0% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0);
  }
  20% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1.2);
  }
  80% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
}

.level-up-icon {
  font-size: 5rem;
  margin-bottom: 1rem;
  animation: bounce 0.6s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.level-up-text {
  font-size: 2.5rem;
  font-weight: bold;
  color: #fff;
  margin-bottom: 0.5rem;
  text-transform: uppercase;
}

.level-up-number {
  font-size: 3.5rem;
  color: #fbbf24;
  font-weight: bold;
}
</style>

<!-- Level Up Notification -->
<div class="level-up-notification" id="levelUpNotification">
  <div class="level-up-icon">ðŸŽ‰</div>
  <div class="level-up-text">LEVEL UP!</div>
  <div class="level-up-number" id="newLevelText">2</div>
</div>

<% if (typeof user !== 'undefined') { %>
<script>
// Level system for navbar
const userId = '<%= user._id %>'
let currentLevel = <%= user.level %>
let currentXP = <%= user.xp ? user.xp : 0 %>

// Calculate XP needed for level
function getXPForLevel(level) {
  if (level >= 1000) return Infinity
  return Math.floor(100 * Math.pow(level, 1.5))
}

// Get level badge
function getLevelBadge(level) {
  if (level >= 1000) return 'ðŸ‘‘'
  if (level >= 500) return 'ðŸ’Ž'
  if (level >= 250) return 'ðŸ†'
  if (level >= 100) return 'ðŸ¥‡'
  if (level >= 50) return 'ðŸ¥ˆ'
  if (level >= 25) return 'ðŸ¥‰'
  return 'ðŸŽ®'
}

// Update navbar XP bar
function updateNavbarXP() {
  const xpNeeded = getXPForLevel(currentLevel)
  const percentage = (currentXP / xpNeeded) * 100
  const progressBar = document.getElementById('navLevelProgress')
  if (progressBar) {
    progressBar.style.width = percentage + '%'
  }
}

updateNavbarXP()

// Socket connection
if (typeof io !== 'undefined') {
  const socket = io()
  
  // Listen for XP updates
  socket.on('xp:updated', (data) => {
    currentXP = data.xp
    currentLevel = data.level
    updateNavbarXP()
  })
  
  // Listen for level ups
  socket.on('level:up', (data) => {
    if (data.userId === userId) {
      currentLevel = data.level
      currentXP = 0
      
      // Update navbar display
      const navLevel = document.getElementById('navLevel')
      if (navLevel) {
        navLevel.textContent = currentLevel
      }
      
      // Update badge
      const badges = document.querySelectorAll('.level-badge')
      badges.forEach(badge => {
        badge.textContent = getLevelBadge(currentLevel)
      })
      
      // Show level up notification
      const notification = document.getElementById('levelUpNotification')
      const levelText = document.getElementById('newLevelText')
      if (notification && levelText) {
        levelText.textContent = currentLevel
        notification.classList.add('show')
        setTimeout(() => notification.classList.remove('show'), 2000)
      }
      
      updateNavbarXP()
    }
  })
  
  // Emit bet placed event (call this from your games)
  window.emitBetPlaced = function(betAmount) {
    socket.emit('bet:placed', { userId, betAmount })
  }
}

function logout() {
  window.location.href = '/logout'
}
</script>
<% } %>
